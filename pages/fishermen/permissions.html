<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Permissions - Fish Inspector App</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#11b4d4",
                        "background-light": "#f6f8f8",
                        "background-dark": "#101f22",
                    },
                    fontFamily: {
                        display: ["Public Sans"],
                    },
                    borderRadius: {
                        DEFAULT: "0.25rem",
                        lg: "0.5rem",
                        xl: "0.75rem",
                        full: "9999px",
                    },
                },
            },
        };
    </script>
    <link href="../../css/styles.css" rel="stylesheet"/>
</head>
<body class="bg-background-light font-display flex flex-col min-h-screen">
    <div class="page active" id="permissionsPage">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold text-gray-800">Permissions</h1>
            </div>
            
            <div class="card max-w-md mx-auto space-y-8">
                <!-- Location Permission -->
                <div class="flex flex-col items-center">
                    <div class="bg-blue-100 p-4 rounded-full mb-3">
                        <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </div>
                    <h2 class="text-xl font-bold mb-2">Location Access</h2>
                    <p class="text-gray-600 text-center mb-4">To accurately record your catch location, we need access to your device's location. This helps us ensure fair pricing and track fishing activity.</p>
                    <button id="locationPermissionBtn" class="btn-primary w-full" onclick="requestLocationPermission()">Grant Location Access</button>
                </div>
                
                <!-- Camera Permission -->
                <div class="flex flex-col items-center">
                    <div class="bg-blue-100 p-4 rounded-full mb-3">
                        <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </div>
                    <h2 class="text-xl font-bold mb-2">Camera Access</h2>
                    <p class="text-gray-600 text-center mb-4">We need camera access to allow you to take photos of your catch. This helps buyers verify the quality and quantity of your fish.</p>
                    <button id="cameraPermissionBtn" class="btn-primary w-full" onclick="requestCameraPermission()">Grant Camera Access</button>
                </div>
                
                <div class="text-center">
                    <button class="text-gray-500" onclick="skipPermissions()">Maybe Later</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Navigation -->
    <div class="footer-nav grid grid-cols-3 gap-2 mt-auto">
        <button class="footer-nav-button active">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
            </svg>
            <span class="text-xs">Home</span>
        </button>
        <button class="footer-nav-button">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                <path d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
            </svg>
            <span class="text-xs">Catches</span>
        </button>
        <button class="footer-nav-button">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
            </svg>
            <span class="text-xs">Profile</span>
        </button>
    </div>

    <script src="../../js/main.js"></script>
    <script src="../../js/fishermen.js"></script>
    <script>
        // Permission request functions
        function requestLocationPermission() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        // Success - location permission granted
                        document.getElementById('locationPermissionBtn').classList.remove('btn-primary');
                        document.getElementById('locationPermissionBtn').classList.add('btn-success');
                        document.getElementById('locationPermissionBtn').textContent = 'Location Access Granted';
                        
                        // Store that permission was granted
                        localStorage.setItem('locationPermissionGranted', 'true');
                        
                        // Check if both permissions are granted
                        checkAllPermissions();
                    },
                    function(error) {
                        // Error - permission denied
                        alert('Location permission denied. Please enable location services to continue.');
                    }
                );
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }
        
        function requestCameraPermission() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        // Success - camera permission granted
                        document.getElementById('cameraPermissionBtn').classList.remove('btn-primary');
                        document.getElementById('cameraPermissionBtn').classList.add('btn-success');
                        document.getElementById('cameraPermissionBtn').textContent = 'Camera Access Granted';
                        
                        // Store that permission was granted
                        localStorage.setItem('cameraPermissionGranted', 'true');
                        
                        // Stop the camera stream since we just needed permission
                        stream.getTracks().forEach(track => {
                            track.stop();
                        });
                        
                        // Check if both permissions are granted
                        checkAllPermissions();
                    })
                    .catch(function(error) {
                        // Error - permission denied
                        alert('Camera permission denied. Please enable camera access to continue.');
                    });
            } else {
                alert('Camera access is not supported by this browser.');
            }
        }
        
        function checkAllPermissions() {
            const locationGranted = localStorage.getItem('locationPermissionGranted') === 'true';
            const cameraGranted = localStorage.getItem('cameraPermissionGranted') === 'true';
            
            if (locationGranted && cameraGranted) {
                // Both permissions granted, proceed to next screen
                setTimeout(function() {
                    showFishermanDashboard();
                }, 1000);
            }
        }
        
        function skipPermissions() {
            // User chose to skip permissions
            showFishermanDashboard();
        }
        
        // Check if permissions were already granted
        window.onload = function() {
            const locationGranted = localStorage.getItem('locationPermissionGranted') === 'true';
            const cameraGranted = localStorage.getItem('cameraPermissionGranted') === 'true';
            
            if (locationGranted) {
                document.getElementById('locationPermissionBtn').classList.remove('btn-primary');
                document.getElementById('locationPermissionBtn').classList.add('btn-success');
                document.getElementById('locationPermissionBtn').textContent = 'Location Access Granted';
            }
            
            if (cameraGranted) {
                document.getElementById('cameraPermissionBtn').classList.remove('btn-primary');
                document.getElementById('cameraPermissionBtn').classList.add('btn-success');
                document.getElementById('cameraPermissionBtn').textContent = 'Camera Access Granted';
            }
            
            if (locationGranted && cameraGranted) {
                // Both permissions already granted, proceed to next screen
                showFishermanDashboard();
            }
        };
    </script>
</body>
</html>